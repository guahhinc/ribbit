<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Ribbit</title>

    <!-- Google Fonts: Inter Tight & Filled Material Symbols -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter+Tight:wght@300;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,1,0" />

    <style>
        :root {
            --background-color: #000000;
            --text-color: #ffffff;
            --header-icon-bg: rgba(30, 30, 30, 0.7);
            --header-icon-border: rgba(255, 255, 255, 0.1);
            --setting-item-bg: #1e1e1e;
            
            --card-width: 90vw;
            --card-max-width: 380px;
            --card-height: 65vh;
            --card-max-height: 550px;
            --animation-speed: 0.2s;
            --page-transition-speed: 0.4s;
        }

        body.light-mode {
            --background-color: #f0f2f5;
            --text-color: #1c1e21;
            --header-icon-bg: rgba(255, 255, 255, 0.7);
            --header-icon-border: rgba(0, 0, 0, 0.1);
            --setting-item-bg: #ffffff;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            font-family: 'Inter Tight', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            overflow: hidden;
            position: relative;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .material-symbols-outlined {
          font-variation-settings: 'FILL' 1;
        }

        .header {
            position: fixed; top: 0; left: 0; width: 100%;
            padding: 15px 20px; box-sizing: border-box; z-index: 100;
        }
        body.light-mode .header {
             background: linear-gradient(180deg, rgba(240,242,245,0.5) 0%, rgba(240,242,245,0) 100%);
        }
        body:not(.light-mode) .header {
            background: linear-gradient(180deg, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0) 100%);
        }
        .header-content {
            display: flex; justify-content: space-between; align-items: center; width: 100%;
        }
        .page-title { margin: 0; font-size: 1.8rem; font-weight: 600; }
        .header-icons { display: flex; gap: 10px; }
        .header-icon-button {
            background-color: var(--header-icon-bg);
            border: 1px solid var(--header-icon-border);
            color: var(--text-color); cursor: pointer; width: 44px; height: 44px;
            border-radius: 50%; display: flex; justify-content: center;
            align-items: center; backdrop-filter: blur(10px);
        }
        .header-icon-button .material-symbols-outlined { font-size: 28px; }
        #liked-header, #settings-header { display: none; }

        .view {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; justify-content: flex-start; align-items: flex-start;
            padding-top: 100px; box-sizing: border-box;
            transition: opacity var(--page-transition-speed) ease-in-out, transform var(--page-transition-speed) ease-in-out;
            opacity: 0; transform: scale(1.1); pointer-events: none;
            overflow-y: auto;
        }
        .view-content { width: 100%; display: flex; justify-content: center; align-items: center; }
        .view.active { opacity: 1; transform: scale(1); pointer-events: auto; }

        .card-container {
            position: relative; width: var(--card-width); max-width: var(--card-max-width);
            height: var(--card-height); max-height: var(--card-max-height);
        }

        .card {
            position: absolute; width: 100%; height: 100%; background-size: 200% 200%;
            animation: gradientShift 15s ease infinite; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); color: white; display: flex; justify-content: center;
            align-items: center; padding: 30px; box-sizing: border-box; text-align: center;
            font-size: 1.7rem; font-weight: 300; line-height: 1.5; text-shadow: 0 2px 4px rgba(0,0,0,0.4);
            cursor: grab; user-select: none; will-change: transform;
            transition: transform var(--animation-speed) cubic-bezier(0.25, 0.8, 0.25, 1), opacity var(--animation-speed) ease;
            overflow: hidden;
        }

        .card.dragging { transition: none; }
        .card.entering-bottom { transform: translateY(100vh) scale(0.8); opacity: 0; }
        .card.entering-left { transform: translateX(-100vw) scale(0.8); opacity: 0; }
        
        @keyframes gradientShift { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }

        .feedback-animation {
            font-family: 'Material Symbols Outlined'; font-size: 6rem; position: absolute;
            transform: translate(-50%, -50%) scale(0.5); pointer-events: none;
            animation: feedback-beat 0.6s ease-in-out;
        }
        .feedback-animation.heart { color: white; }
        .feedback-animation.unheart { color: #888; animation-name: feedback-fade; }

        @keyframes feedback-beat { 0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; } 50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.9; } 100% { transform: translate(-50%, -50%) scale(1.1); opacity: 0; } }
        @keyframes feedback-fade { 0% { transform: translate(-50%, -50%) scale(1); opacity: 0.9; } 100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; } }

        /* Settings Page Styles */
        .settings-container { width: 100%; max-width: 400px; padding-bottom: 50px; }
        .setting-item {
            background-color: var(--setting-item-bg);
            border-radius: 10px; padding: 15px;
            margin-bottom: 15px; display: flex;
            justify-content: space-between; align-items: center;
            transition: background-color 0.3s ease;
        }
        .setting-item label { font-size: 1rem; font-weight: 300; }
        .setting-item button {
            background: none; border: none; font-size: 1rem; font-weight: 600;
            color: #3498db; cursor: pointer; font-family: 'Inter Tight', sans-serif;
        }
        #clear-data-button { color: #e74c3c; }
        .version-text { font-size: 0.9rem; color: #888; }

        .toggle-switch {
            position: relative; display: inline-block; width: 50px; height: 28px;
        }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: #333; transition: .4s; border-radius: 28px;
        }
        .slider:before {
            position: absolute; content: ""; height: 20px; width: 20px;
            left: 4px; bottom: 4px; background-color: white;
            transition: .4s; border-radius: 50%;
        }
        body.light-mode .slider { background-color: #ccc; }
        input:checked + .slider { background-color: #27ae60; }
        input:checked + .slider:before { transform: translateX(22px); }
    </style>
</head>
<body>

    <header class="header">
        <div id="home-header" class="header-content">
            <h1 class="page-title">Home</h1>
            <div class="header-icons">
                <button id="go-to-settings-button" class="header-icon-button">
                    <span class="material-symbols-outlined">settings</span>
                </button>
                <button id="go-to-liked-button" class="header-icon-button">
                    <span class="material-symbols-outlined">favorite</span>
                </button>
            </div>
        </div>
        <div id="liked-header" class="header-content">
            <h1 class="page-title">Liked</h1>
            <button id="go-to-home-button" class="header-icon-button">
                 <span class="material-symbols-outlined">home</span>
            </button>
        </div>
        <div id="settings-header" class="header-content">
            <h1 class="page-title">Settings</h1>
             <button id="done-settings-button" class="header-icon-button">
                 <span class="material-symbols-outlined">done</span>
            </button>
        </div>
    </header>

    <div id="main-view" class="view active">
        <div class="view-content"><div id="main-card-container" class="card-container"></div></div>
    </div>

    <div id="liked-view" class="view">
        <div class="view-content"><div id="liked-card-container" class="card-container"></div></div>
    </div>

    <div id="settings-view" class="view">
        <div class="settings-container">
            <div class="setting-item">
                <label for="update-app-button">Check for updates</label>
                <button id="update-app-button">Update App</button>
            </div>
            <div class="setting-item">
                <label>Version</label>
                <span class="version-text">v0.1.1 Beta</span>
            </div>
            <div class="setting-item">
                <label for="clear-data-button">Erase all liked quotes</label>
                <button id="clear-data-button">Erase</button>
            </div>
            <div class="setting-item">
                <label for="theme-toggle">Light Mode</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="theme-toggle">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const masterQuotes = [
                { id: 1, text: "The secret of getting ahead is getting started.", colors: ['#2c3e50', '#4ca1af'] }, { id: 2, text: "The only way to do great work is to love what you do.", colors: ['#8E2DE2', '#4A00E0'] }, { id: 3, text: "Act as if what you do makes a difference. It does.", colors: ['#159957', '#155799'] }, { id: 4, text: "Believe you can and you're halfway there.", colors: ['#cb2d3e', '#ef473a'] }, { id: 5, text: "The journey of a thousand miles begins with a single step.", colors: ['#00b09b', '#96c93d'] }, { id: 6, text: "What you get by achieving your goals is not as important as what you become.", colors: ["#434343", "#000000"] }, { id: 7, text: "The best time to plant a tree was 20 years ago. The second best time is now.", colors: ["#134E5E", "#71B280"] }, { id: 8, text: "Your limitation is only your imagination.", colors: ["#ff4e50", "#f9d423"] }, { id: 9, text: "Strive not to be a success, but rather to be of value.", colors: ["#c31432", "#240b36"] }, { id: 10, text: "The mind is everything. What you think you become.", colors: ["#614385", "#516395"] }, { id: 11, text: "An unexamined life is not worth living.", colors: ["#360033", "#0b8793"] }, { id: 12, text: "Eighty percent of success is showing up.", colors: ["#1c92d2", "#f2fcfe"] }, { id: 13, text: "You miss 100% of the shots you don't take.", colors: ["#f12711", "#f5af19"] }, { id: 14, text: "The only person you are destined to become is the person you decide to be.", colors: ["#7F00FF", "#E100FF"] }, { id: 15, text: "Everything you can imagine is real.", colors: ["#1A2980", "#26D0CE"] }, { id: 16, text: "Do what you can, with what you have, where you are.", colors: ["#00467F", "#A5CC82"] }, { id: 17, text: "The best revenge is massive success.", colors: ["#ED213A", "#93291E"] }, { id: 18, text: "If you are not willing to risk the usual you will have to settle for the ordinary.", colors: ["#485563", "#29323c"] }, { id: 19, text: "All our dreams can come true, if we have the courage to pursue them.", colors: ["#e52d27", "#b31217"] }, { id: 20, text: "Don't watch the clock; do what it does. Keep going.", colors: ["#0F2027", "#2C5364"] }, { id: 21, text: "The future belongs to those who believe in the beauty of their dreams.", colors: ["#FF8008", "#FFC837"] }, { id: 22, text: "There are no shortcuts to any place worth going.", colors: ["#005C97", "#363795"] }, { id: 23, text: "Success is not in what you have, but who you are.", colors: ["#00c3ff", "#ffff1c"] }, { id: 24, text: "In the middle of difficulty lies opportunity.", colors: ["#2C3E50", "#FD746C"] }, { id: 25, text: "It is never too late to be what you might have been.", colors: ["#5614B0", "#DBD65C"] }, { id: 26, text: "You must be the change you wish to see in the world.", colors: ["#348F50", "#56B4D3"] }, { id: 27, text: "Fall seven times and stand up eight.", colors: ["#283c86", "#45a247"] }, { id: 28, text: "The only impossible journey is the one you never begin.", colors: ["#1e3c72", "#2a5298"] }, { id: 29, text: "Happiness is not something ready made. It comes from your own actions.", colors: ["#f857a6", "#ff5858"] }, { id: 30, text: "To live is the rarest thing in the world. Most people exist, that is all.", colors: ["#1D2B64", "#F8CDDA"] }, { id: 31, text: "Turn your wounds into wisdom.", colors: ["#5C258D", "#4389A2"] }, { id: 32, text: "Wherever you go, go with all your heart.", colors: ["#e96443", "#904e95"] }, { id: 33, text: "To be yourself in a world that is constantly trying to make you something else is the greatest accomplishment.", colors: ["#3a6186", "#89253e"] }, { id: 34, text: "The purpose of our lives is to be happy.", colors: ["#2980B9", "#6DD5FA"] }, { id: 35, text: "You will face many defeats in life, but never let yourself be defeated.", colors: ["#536976", "#292E49"] }, { id: 36, text: "Life is what happens when you're busy making other plans.", colors: ["#BBD2C5", "#536976"] }, { id: 37, text: "The greatest glory in living lies not in never falling, but in rising every time we fall.", colors: ["#70e1f5", "#ffd194"] }, { id: 38, text: "In the end, it's not the years in your life that count. It's the life in your years.", colors: ["#4776E6", "#8E54E9"] }, { id: 39, text: "Life is a succession of lessons which must be lived to be understood.", colors: ["#ff7e5f", "#feb47b"] }, { id: 40, text: "You have within you right now, everything you need to deal with whatever the world can throw at you.", colors: ["#314755", "#26a0da"] },
                { id: 41, text: "The only thing we have to fear is fear itself.", colors: ['#536976', '#BB2222'] }, { id: 42, text: "To err is human, to forgive divine.", colors: ['#f8b500', '#fceabb'] }, { id: 43, text: "What we think, we become.", colors: ['#373B44', '#4286f4'] }, { id: 44, text: "Be the reason someone smiles today.", colors: ['#FC466B', '#3F5EFB'] }, { id: 45, text: "Simplicity is the ultimate sophistication.", colors: ['#D3CCE3', '#E9E4F0'] }, { id: 46, text: "Whatever you are, be a good one.", colors: ['#3D7EAA', '#FFE47A'] }, { id: 47, text: "Tough times never last, but tough people do.", colors: ['#141E30', '#243B55'] }, { id: 48, text: "Problems are not stop signs, they are guidelines.", colors: ['#1c92d2', '#f2fcfe'] }, { id: 49, text: "Have enough courage to start and enough heart to finish.", colors: ['#ff6a00', '#ee0979'] }, { id: 50, text: "Hate comes from intimidation, love comes from appreciation.", colors: ['#da4453', '#89216b'] }, { id: 51, text: "Determine your priorities and focus on them.", colors: ['#000428', '#004e92'] }, { id: 52, text: "Be so good they can't ignore you.", colors: ['#232526', '#414345'] }, { id: 53, text: "Yesterday you said tomorrow. Just do it.", colors: ['#F2994A', '#F2C94C'] }, { id: 54, text: "The secret to life is to fall in love with as many things as possible.", colors: ['#FF416C', '#FF4B2B'] }, { id: 55, text: "I could agree with you but then we’d both be wrong.", colors: ['#2b5876', '#4e4376'] }, { id: 56, text: "Light travels faster than sound. This is why some people appear bright until you hear them speak.", colors: ['#F00000', '#DC281E'] }, { id: 57, text: "Well begun is half done.", colors: ['#42275a', '#734b6d'] }, { id: 58, text: "He who is brave is free.", colors: ['#3C3B3F', '#605C3C'] }, { id: 59, text: "The truest wisdom is a resolute determination.", colors: ['#1e130c', '#9a8478'] }, { id: 60, text: "Life is a flower of which love is the honey.", colors: ['#f953c6', '#b91d73'] }, { id: 61, text: "All limitations are self-imposed.", colors: ['#3D7EAA', '#FFE47A'] }, { id: 62, text: "Dream big and dare to fail.", colors: ['#43C6AC', '#191654'] }, { id: 63, text: "Every moment is a fresh beginning.", colors: ['#007991', '#78ffd6'] }, { id: 64, text: "Die with memories, not dreams.", colors: ['#2948ff', '#396afc'] }, { id: 65, text: "What you do today can improve all your tomorrows.", colors: ['#a1c4fd', '#c2e9fb'] }, { id: 66, text: "A smooth sea never made a skilled sailor.", colors: ['#005AA7', '#FFFDE4'] }, { id: 67, text: "Every day is a second chance.", colors: ['#fdfc47', '#24fe41'] }, { id: 68, text: "It's not the load that breaks you down, it's the way you carry it.", colors: ['#000000', '#53346D'] }, { id: 69, text: "The harder you work for something, the greater you'll feel when you achieve it.", colors: ['#753a88', '#cc2b5e'] }, { id: 70, text: "Dream it. Wish it. Do it.", colors: ['#4568DC', '#B06AB3'] }, { id: 71, text: "Push yourself, because no one else is going to do it for you.", colors: ['#2193b0', '#6dd5ed'] }, { id: 72, "text": "Great things never come from comfort zones.", "colors": ["#C04848", "#480048"] }, { id: 73, "text": "The key to success is to focus on goals, not obstacles.", "colors": ["#42275a", "#734b6d"] }, { id: 74, "text": "Your attitude determines your direction.", "colors": ["#5f2c82", "#49a09d"] }, { id: 75, "text": "Make each day your masterpiece.", "colors": ["#1FA2FF", "#A6FFCB"] }, { id: 76, "text": "Never regret anything that made you smile.", "colors": ["#DD2476", "#FF512F"] }, { id: 77, "text": "Once you choose hope, anything’s possible.", "colors": ["#00B4DB", "#0083B0"] }, { id: 78, "text": "Try to be a rainbow in someone's cloud.", "colors": ["#f80759", "#bc4e9c"] }, { id: 79, "text": "Stars can't shine without darkness.", "colors": ["#000000", "#4A00E0"] }, { id: 80, "text": "It is better to travel well than to arrive.", "colors": ["#40E0D0", "#FF8C00"] },
                { id: 81, text: "Life is short, and it is up to you to make it sweet.", colors: ["#f2709c", "#ff9472"] }, { id: 82, text: "The best way to get started is to quit talking and begin doing.", colors: ["#4facfe", "#00f2fe"] }, { id: 83, text: "Don't let yesterday take up too much of today.", colors: ["#ff9a9e", "#fecfef"] }, { id: 84, text: "We may encounter many defeats but we must not be defeated.", colors: ["#ffdde1", "#ee9ca7"] }, { id: 85, text: "The man who has confidence in himself gains the confidence of others.", colors: ["#3f2b96", "#a8c0ff"] }, { id: 86, text: "Creativity is intelligence having fun.", colors: ["#11998e", "#38ef7d"] }, { id: 87, text: "If you want to lift yourself up, lift up someone else.", colors: ["#fceabb", "#f8b500"] }, { id: 88, text: "What you lack in talent can be made up with desire, hustle and giving 110% all the time.", colors: ["#eb3349", "#f45c43"] }, { id: 89, text: "A person who never made a mistake never tried anything new.", colors: ["#4b79a1", "#283e51"] }, { id: 90, text: "It's not whether you get knocked down, it's whether you get up.", colors: ["#76b852", "#8DC26F"] }, { id: 91, text: "If you're going through hell, keep going.", colors: ["#e43a15", "#e65245"] }, { id: 92, text: "The most difficult thing is the decision to act, the rest is merely tenacity.", colors: ["#cc2b5e", "#753a88"] }, { id: 93, text: "It is during our darkest moments that we must focus to see the light.", colors: ["#2c3e50", "#fd746c"] }, { id: 94, "text": "An obstacle is often a stepping stone.", "colors": ["#757F9A", "#D7DDE8"] }, { id: 95, "text": "You do not find the happy life. You make it.", "colors": ["#FFC371", "#FF5F6D"] }, { id: 96, "text": "Let the beauty of what you love be what you do.", "colors": ["#06beb6", "#48b1bf"] }, { id: 97, "text": "The world is full of nice people. If you can't find one, be one.", "colors": ["#e55d87", "#5fc3e4"] }, { id: 98, "text": "No matter what you're going through, there's a light at the end of the tunnel.", "colors": ["#F3F9A7", "#CAC531"] }, { id: 99, "text": "Kindness is a language which the deaf can hear and the blind can see.", "colors": ["#1c4229", "#248232"] }, { id: 100, "text": "Nothing is impossible. The word itself says 'I'm possible!'", "colors": ["#00c6ff", "#0072ff"] },
                { id: 101, text: "The only true wisdom is in knowing you know nothing.", colors: ["#606c88", "#3f4c6b"] }, { id: 102, text: "An investment in knowledge pays the best interest.", colors: ["#1f4037", "#99f2c8"] }, { id: 103, text: "The measure of intelligence is the ability to change.", colors: ["#83a4d4", "#b6fbff"] }, { id: 104, text: "You can't cross the sea merely by standing and staring at the water.", colors: ["#0052D4", "#65C7F7"] }, { id: 105, text: "A goal is a dream with a deadline.", colors: ["#ff512f", "#dd2476"] }, { id: 106, text: "Either you run the day or the day runs you.", colors: ["#7b4397", "#dc2430"] }, { id: 107, text: "Build your own dreams, or someone else will hire you to build theirs.", colors: ["#36D1DC", "#5B86E5"] }, { id: 108, text: "There is only one corner of the universe you can be certain of improving, and that's your own self.", colors: ["#9796f0", "#fbc7d4"] }, { id: 109, text: "What seems to us as bitter trials are often blessings in disguise.", colors: ["#20002c", "#cbb4d4"] }, { id: 110, text: "Change your thoughts and you change your world.", colors: ["#5433FF", "#A5FECB"] }, { id: 111, text: "If there is no struggle, there is no progress.", colors: ["#23074d", "#cc5333"] }, { id: 112, text: "The undertaking of a new action brings new strength.", colors: ["#3C1053", "#AD5389"] }, { id: 113, text: "Believe that life is worth living and your belief will help create the fact.", colors: ["#1565C0", "#b92b27"] }, { id: 114, text: "Go forth and set the world on fire.", colors: ["#f12711", "#f5af19"] }, { id: 115, text: "The power of imagination makes us infinite.", colors: ["#474342", "#895a43"] }, { id: 116, text: "Embrace the glorious mess that you are.", colors: ["#654ea3", "#eaafc8"] }, { id: 117, text: "Normality is a paved road: It’s comfortable to walk, but no flowers grow on it.", colors: ["#34e89e", "#0f3443"] }, { id: 118, text: "We are all in the gutter, but some of us are looking at the stars.", colors: ["#0F2027", "#2C5364"] }, { id: 119, text: "I have not failed. I've just found 10,000 ways that won't work.", colors: ["#8e9eab", "#eef2f3"] }, { id: 120, text: "It is a fine thing to have an open mind, but not so open that your brains fall out.", colors: ["#403A3E", "#BE5869"] }
            ];

            const mainView = document.getElementById('main-view');
            const likedView = document.getElementById('liked-view');
            const settingsView = document.getElementById('settings-view');
            const homeHeader = document.getElementById('home-header');
            const likedHeader = document.getElementById('liked-header');
            const settingsHeader = document.getElementById('settings-header');
            const animationSpeed = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--animation-speed')) * 1000;

            const DB_KEY = 'mindfulDecksFavorites_v6';
            const THEME_KEY = 'mindfulDecksTheme_v6';
            let favorites = JSON.parse(localStorage.getItem(DB_KEY)) || [];
            let mainDeck = [];
            let mainHistory = [];
            
            const saveFavorites = () => localStorage.setItem(DB_KEY, JSON.stringify(favorites));

            function createCardElement(quote) {
                const card = document.createElement('div');
                card.className = 'card';
                card.style.background = `linear-gradient(160deg, ${quote.colors[0]}, ${quote.colors[1]})`;
                card.dataset.id = quote.id;
                card.innerHTML = `<span>${quote.text}</span>`;
                return card;
            }
            
            function createDeckManager(deckType) {
                const container = deckType === 'main' ? document.getElementById('main-card-container') : document.getElementById('liked-card-container');
                let currentDeck = [];
                let history = [];
                let currentIndex = 0;

                function getNextCard() {
                    if (deckType === 'main') {
                        const currentQuote = currentDeck[0];
                        if (currentQuote) history.push(currentQuote);
                        currentDeck.shift();
                        if (currentDeck.length === 0) {
                            currentDeck.push(...masterQuotes.sort(() => Math.random() - 0.5).filter(q => !history.some(h => h.id === q.id)));
                        }
                        return currentDeck[0];
                    } else { // Liked deck
                        if(currentDeck.length === 0) return null;
                        this.currentIndex = (this.currentIndex + 1) % currentDeck.length;
                        return currentDeck[this.currentIndex];
                    }
                }

                function getPreviousCard() {
                     if (deckType === 'main') {
                        if (history.length === 0) return null;
                        currentDeck.unshift(history.pop());
                        return currentDeck[0];
                    } else { // Liked deck
                         if(currentDeck.length === 0) return null;
                        this.currentIndex = (this.currentIndex - 1 + currentDeck.length) % currentDeck.length;
                        return currentDeck[this.currentIndex];
                    }
                }

                function onDoubleTap(card, e) {
                    const quoteId = parseInt(card.dataset.id);
                    if (quoteId < 0) return;
                    const isFavorited = favorites.some(fav => fav.id === quoteId);

                    if (deckType === 'main') {
                        animateFeedback(card, e, 'favorite', 'heart');
                        if (!isFavorited) {
                           const quote = masterQuotes.find(q => q.id === quoteId);
                           if (quote) favorites.push(quote);
                           saveFavorites();
                        }
                    } else if (deckType === 'liked' && isFavorited) {
                        favorites = favorites.filter(fav => fav.id !== quoteId);
                        saveFavorites();
                        animateFeedback(card, e, 'heart_broken', 'unheart');
                         setTimeout(() => {
                           card.style.transform = `translateY(100vh) rotate(30deg)`;
                           card.style.opacity = 0;
                           setTimeout(() => {
                                card.remove();
                                this.reset();
                                this.start();
                           }, animationSpeed);
                        }, 300);
                    }
                }
                
                function animateFeedback(card, e, icon, className){
                    const rect = card.getBoundingClientRect();
                    const x = (e.clientX ?? e.touches[0].clientX) - rect.left;
                    const y = (e.clientY ?? e.touches[0].clientY) - rect.top;
                    const feedback = document.createElement('div');
                    feedback.className = 'feedback-animation ' + className;
                    feedback.innerHTML = icon;
                    feedback.style.left = `${x}px`;
                    feedback.style.top = `${y}px`;
                    card.appendChild(feedback);
                    feedback.addEventListener('animationend', () => feedback.remove());
                }

                function start() {
                    container.innerHTML = '';
                    let quote;
                    if (deckType === 'main') {
                        if(mainDeck.length === 0) mainDeck.push(...masterQuotes.sort(() => Math.random() - 0.5));
                        currentDeck = mainDeck;
                        history = mainHistory;
                        quote = currentDeck[0];
                    } else {
                        currentDeck = [...favorites];
                        history = [];
                        this.currentIndex = -1;
                        quote = currentDeck.length > 0 ? getNextCard.call(this) : null;
                    }
                    
                    if (!quote) {
                        if (deckType === 'liked') {
                             const emptyCard = createCardElement({id: -1, text: "Double-tap cards on the home screen to add them here.", colors: ["#434343", "#000000"]});
                             container.appendChild(emptyCard);
                        }
                        return;
                    }
                    
                    const card = createCardElement(quote);
                    card.classList.add('entering-bottom');
                    container.appendChild(card);
                    setTimeout(() => card.classList.remove('entering-bottom'), 20);
                    initCardListeners(card);
                }

                function initCardListeners(card) {
                    let startX = 0, isDragging = false, lastTap = 0, hasMoved = false;

                    function onPointerDown(e) {
                        const currentTime = new Date().getTime();
                        if (currentTime - lastTap < 250) {
                            lastTap = 0; onDoubleTap(card, e); return;
                        }
                        lastTap = currentTime;

                        hasMoved = false; isDragging = true;
                        startX = e.pageX ?? e.touches[0].pageX;
                        
                        document.addEventListener('mousemove', onPointerMove, { passive: false });
                        document.addEventListener('touchmove', onPointerMove, { passive: false });
                        document.addEventListener('mouseup', onPointerEnd);
                        document.addEventListener('touchend', onPointerEnd);
                    }

                    function onPointerMove(e) {
                        if (!isDragging) return;
                        const currentX = e.pageX ?? e.touches[0].pageX;
                        const deltaX = currentX - startX;
                        if(!hasMoved && Math.abs(deltaX) > 5){
                             hasMoved = true; card.classList.add('dragging');
                        }
                        if(hasMoved) {
                            e.preventDefault();
                            card.style.transform = `translateX(${deltaX}px) rotate(${deltaX / 20}deg)`;
                        }
                    }

                    function onPointerEnd(e) {
                        document.removeEventListener('mousemove', onPointerMove); document.removeEventListener('touchmove', onPointerMove);
                        document.removeEventListener('mouseup', onPointerEnd); document.removeEventListener('touchend', onPointerEnd);
                        if (!hasMoved) { isDragging = false; return; }
                        isDragging = false;
                        card.classList.remove('dragging');
                        const deltaX = (e.pageX ?? e.changedTouches?.[0].pageX ?? startX) - startX;

                        if (Math.abs(deltaX) > (window.innerWidth / 6.5)) {
                            const direction = deltaX > 0 ? 1 : -1;
                            if (direction === 1 && history.length === 0 && deckType === 'main') {
                                card.style.transform = ''; return;
                            }
                            card.style.transition = `transform ${animationSpeed / 1000}s ease-out`;
                            card.style.transform = `translateX(${direction * window.innerWidth}px) rotate(${direction * 30}deg)`;
                            setTimeout(() => {
                                card.remove();
                                const getCardFn = direction === -1 ? getNextCard : getPreviousCard;
                                const quote = getCardFn.call(this);
                                if (quote) {
                                    const newCard = createCardElement(quote);
                                    newCard.classList.add(direction === -1 ? 'entering-bottom' : 'entering-left');
                                    container.appendChild(newCard);
                                    setTimeout(() => newCard.classList.remove(direction === -1 ? 'entering-bottom' : 'entering-left'), 20);
                                    initCardListeners(newCard);
                                } else if (deckType === 'liked'){ this.start(); }
                            }, animationSpeed);
                        } else { card.style.transform = ''; }
                    }
                    card.addEventListener('mousedown', onPointerDown);
                    card.addEventListener('touchstart', onPointerDown, { passive: true });
                }

                return { start, reset: function() { currentDeck = []; history = []; this.currentIndex = 0; } };
            }

            const mainManager = createDeckManager('main');
            const likedManager = createDeckManager('liked');
            
            // --- VIEW NAVIGATION ---
            function switchView(activeView, activeHeader){
                document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                document.querySelectorAll('.header-content').forEach(h => h.style.display = 'none');
                activeView.classList.add('active');
                activeHeader.style.display = 'flex';
            }
            document.getElementById('go-to-liked-button').addEventListener('click', () => {
                likedManager.reset(); likedManager.start();
                switchView(likedView, likedHeader);
            });
            document.getElementById('go-to-settings-button').addEventListener('click', () => switchView(settingsView, settingsHeader));
            document.getElementById('go-to-home-button').addEventListener('click', () => switchView(mainView, homeHeader));
            document.getElementById('done-settings-button').addEventListener('click', () => switchView(mainView, homeHeader));

            // --- SETTINGS LOGIC ---
            const themeToggle = document.getElementById('theme-toggle');
            const updateButton = document.getElementById('update-app-button');
            const clearDataButton = document.getElementById('clear-data-button');

            // Theme
            function applyTheme(theme) {
                if (theme === 'light') {
                    document.body.classList.add('light-mode');
                    themeToggle.checked = true;
                } else {
                    document.body.classList.remove('light-mode');
                    themeToggle.checked = false;
                }
            }
            themeToggle.addEventListener('change', () => {
                const newTheme = themeToggle.checked ? 'light' : 'dark';
                localStorage.setItem(THEME_KEY, newTheme);
                applyTheme(newTheme);
            });
            
            // Update
            updateButton.addEventListener('click', () => location.reload());
            
            // Clear Data
            clearDataButton.addEventListener('click', () => {
                if (confirm("Are you sure you want to erase all liked quotes? This action cannot be undone.")) {
                    localStorage.removeItem(DB_KEY);
                    favorites = [];
                    alert("All liked quotes have been erased.");
                    location.reload();
                }
            });

            // --- INITIAL LOAD ---
            applyTheme(localStorage.getItem(THEME_KEY) || 'dark');
            mainManager.start();
        });
    </script>
</body>
</html>
